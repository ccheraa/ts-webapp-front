{"version":3,"file":"loader.service.js","sourceRoot":"","sources":["../../src/service/loader.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { Observable, Subject } from 'rxjs';\r\n\r\nimport { Loader } from '../db';\r\nfunction findIndex(array: any[], callback) {\r\n  if (array === null) {\r\n    throw new TypeError('Array.prototype.findIndex called on null or undefined');\r\n  } else if (typeof callback !== 'function') {\r\n    throw new TypeError('callback must be a function');\r\n  }\r\n  var list = Object(array);\r\n  var length = list.length >>> 0;\r\n  var arrayArg = arguments[1];\r\n  for (var i = 0; i < length; i++) {\r\n    if ( callback.call(arrayArg, list[i], i, list) ) {\r\n      return i;\r\n    }\r\n  }\r\n  return -1;\r\n}\r\n@Injectable()\r\nexport class LoaderService implements Loader {\r\n  private loading: { action: string, cb: Function}[] = [];\r\n  public result: Subject<boolean> = new Subject<boolean>();\r\n  load(action: string, cb?: Function): Observable<boolean> {\r\n    console.log('loading: ' + action + '...');\r\n    if (findIndex(this.loading, loading => loading.action === action) < 0) {\r\n      this.loading.push({\r\n        action,\r\n        cb: cb\r\n      });\r\n    }\r\n    return this.check();\r\n  }\r\n  unload(action: string): Observable<boolean> {\r\n    console.log('unloading: ' + action + '...');\r\n    let found = findIndex(this.loading, loading => loading.action === action);\r\n    if (found > -1) {\r\n      if (this.loading[found].cb) {\r\n        this.loading[found].cb();\r\n      }\r\n      this.loading.splice(found, 1);\r\n    }\r\n    return this.check();\r\n  }\r\n  check(): Observable<boolean>  {\r\n    this.result.next(this.loading.length > 0);\r\n    return this.result;\r\n  }\r\n}\r\n"]}