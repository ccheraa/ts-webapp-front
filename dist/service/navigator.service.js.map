{"version":3,"file":"navigator.service.js","sourceRoot":"","sources":["../../src/service/navigator.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable, Component } from '@angular/core';\r\nimport { Location } from '@angular/common';\r\nimport { Router, CanDeactivate, ActivatedRouteSnapshot, RouterStateSnapshot } from '@angular/router';\r\nimport { Observable, Subject } from 'rxjs';\r\nimport { DialogService } from './dialog.service';\r\n\r\n@Injectable()\r\nexport class NavigatorService implements CanDeactivate<Component> {\r\n  private url: any[] = [];\r\n  // private safeUrl: any[] = [];\r\n  messages = {};\r\n  subscriptions = {};\r\n  public observable: Subject<any[]> = new Subject<any[]>();\r\n  public autoObservable: Subject<any> = new Subject<any>();\r\n  public titleObservable: Subject<string> = new Subject<string>();\r\n  public homeObservable: Subject<boolean> = new Subject<boolean>();\r\n  public menuObservable: Subject<any[]> = new Subject<any[]>();\r\n  public canGo = false;\r\n  constructor(private router: Router, private dialog: DialogService, private location: Location) {\r\n    // window.onbeforeunload = (e) => {\r\n    //   let messages = Object.keys(this.messages)\r\n    //     .map(index => this.messages[index])\r\n    //     .filter(message => message !== '')\r\n    //     .join('\\n');\r\n    //   return messages.length ? messages : null;\r\n    // };\r\n  }\r\n  canDeactivate(\r\n    component: Component,\r\n    route: ActivatedRouteSnapshot,\r\n    state: RouterStateSnapshot\r\n  ): Observable<boolean>|Promise<boolean>|boolean {\r\n    // console.log(component, route, state);\r\n    // this.safeUrl = this.url;\r\n    this.url = [];\r\n    this.canGo = true;\r\n    this.observable.next();\r\n    if (this.canGo) {\r\n      this.home(false);\r\n      return true;\r\n    } else {\r\n      let me = this;\r\n      return this.autoObservable;\r\n    }\r\n    // return this.permissions.canDeactivate(this.currentUser, route.params.id);\r\n  }\r\n  private subscription(id: string, message: string): (value: any) => void {\r\n    return (value: any) => {\r\n      this.canGo = false;\r\n      this.dialog.confirm(message).subscribe(ok => {\r\n        if (ok) {\r\n          this.cancel(id);\r\n          this.resume();\r\n        } else {\r\n          this.reject();\r\n        }\r\n      });\r\n    };\r\n  }\r\n  stop() {\r\n    this.canGo = false;\r\n  }\r\n  reject() {\r\n    // console.log(this.url, this.safeUrl);\r\n    // this.url = this.safeUrl;\r\n    this.autoObservable.next(false);\r\n  }\r\n  cancel(id: string) {\r\n    if (this.subscriptions[id] && this.subscriptions[id].unsubscribe) {\r\n      this.subscriptions[id].unsubscribe();\r\n    }\r\n    delete(this.subscriptions[id]);\r\n    delete(this.messages[id]);\r\n  }\r\n  notify(id: string, subscription: (value: any) => void);\r\n  notify(id: string, message: string, subscription: (value: any) => void);\r\n  notify(id: string, message: string, confirm: boolean);\r\n  notify(id: string, message: string | ((value: any) => void), subscription: (boolean | ((value: any) => void)) = false) {\r\n    if (typeof message === 'function') {\r\n      subscription = message;\r\n      message = '';\r\n    } else if (typeof subscription === 'boolean') {\r\n      subscription = this.subscription(id, message);\r\n    }\r\n    this.messages[id] = message;\r\n    this.subscriptions[id] = this.observable.subscribe(<(value: any) => void>subscription);\r\n    console.log(this.messages, this.subscriptions);\r\n  }\r\n  resume() {\r\n    this.goto(...this.url);\r\n  }\r\n  back() {\r\n    this.location.back();\r\n  }\r\n  goto(...url: any[]) {\r\n    // this.url = url;\r\n    // this.canGo = true;\r\n    // this.observable.next(url);\r\n    // if (this.canGo) {\r\n      if (url.length) {\r\n        this.router.navigate(url);\r\n      } else {\r\n        this.home(false);\r\n        this.autoObservable.next(true);\r\n      }\r\n    // }\r\n  }\r\n  title(title?: string): Observable<string>  {\r\n    if (!(title === null || title === undefined)) {\r\n      this.titleObservable.next(title);\r\n    } else {\r\n      return this.titleObservable;\r\n    }\r\n  }\r\n  home(home?: boolean): Observable<boolean>  {\r\n    if (!(home === null || home === undefined)) {\r\n      this.homeObservable.next(home);\r\n    } else {\r\n      return this.homeObservable;\r\n    }\r\n  }\r\n  menu(menu?: any[]): Observable<any[]>  {\r\n    if (!(menu === null || menu === undefined)) {\r\n      this.menuObservable.next(menu);\r\n    } else {\r\n      return this.menuObservable;\r\n    }\r\n  }\r\n}\r\n\r\nexport const canDeactivate = [NavigatorService];"]}